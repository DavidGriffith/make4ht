make4ht
=======

Simple build system for tex4ht. Some day it may replace `t4ht` for generating `css` and `images`. First aim is to copy or move generated files to correct directories and possibility to write build scripts, allowing to run bibtex or indexing programs from make4ht run.

How it works
------------

Default compilation scripts for `tex4ht` compiles LaTeX files with this sequence:

    latex $latex_options 'code for loading tex4ht.sty \input{filename}'
    latex $latex_options 'code for loading tex4ht.sty \input{filename}'
    latex $latex_options 'code for loading tex4ht.sty \input{filename}'
    tex4ht options filename
    t4ht options filename

Problem is, if you need to run indexing program or bibtex, you need to create new script based on old one, or run htlatex twice, which means six LaTeX runs.

Other problem is with `t4ht` application. It reads file `filename.lg`, generated by `tex4ht`, where are instructions about generated files, css instructions, calls to external applications, instructions for image conversions etc. It can be instrued to copy generated files to some output directory, but it doesn't preserve directory structure, which means that if you have images in some subdirectory, they will be copied to output directory, but links will be pointing to non existing subdir.

Image conversion is directed with the [env file](http://www.tug.org/applications/tex4ht/mn35.html#index35-73001), with really strange syntax based on whitespace and [os dependent](http://www.tug.org/applications/tex4ht/mn-unix.html#index27-69005). Build scripts should be able to take image conversion process and also to enable actions like conversion with xslt processor ot tidy on output files, based on file extensions.

Idea is to use LUA buildfile, with name `filename + .mk4 extension` and specify there actions.

Build file
----------

Sample:

    Make:htlatex()
    Make:match("html$", "tidy -m -xml -utf8 -q -i ${filename}")

This build file will run htlatex one time. You can add more commands like `Make:htlatex` with 

    Make:add("name", "command", {default parameters})

you can run then 

    Make:name()

`command` can be text template, or function:

    Make:add("text", "hello, input file: ${input}")
    Make:add("function", function(params) for k, v in pairs(params) do print(k..": "..v) end)

Default parameters are:

  - htlatex - used compiler
  - input - input file
  - latex_par - parameters to latex
  - tex4ht_sty_par - parameters to tex4ht.sty
  - tex4ht_par - parameters to tex4ht application
  - t4ht_par - parameters to t4ht application
  - outdir - output directory

Other type of actions which can be specified in build file are
functions which are running on the generated files:

    Make:match("html$", "tidy -m -xml -utf8 -q -i ${filename}")

This tests filenames with lua pattern matching and on matched items it run 
command or function specified in second argument". Parameters are the same, as in previous section, except filename, which is generated output name.

Future plans

  - extend documentation
  - add commands for image conversion

